########################################################################
# Frequency Reference PVs

record(acalcout, "$(P)$(R)FPGAClkMAF") {
  field(ASG, "Reserved")
  field(DESC, "FPGA Clock")
  field(SCAN, "1 second")
  field(NELM, "5")
  field(INPA, "$(P)$(R)Freq-Mon")
  field(CALC, "AA:=CAT(AA[1,4],A);AVG(AA)")
  field(FLNK, "$(P)$(R)FPGAClkCalc")
}

record(calcout, "$(P)$(R)FPGAClkCalc") {
  field(ASG, "Reserved")
  field(DESC, "FPGA Clock")
  field(INPA, "$(P)$(R)FPGAClkMAF")
  field(INPB, "$(P)$(R)TimestampSrc-Sel")
  field(INPC, "$(P)$(R)FPGAClk-Cte CPP")
#  field(OUT, "$(P)$(R)FPGAClk-Cte PP")
  field(CALC, "B>0?A:C")
#  field(FLNK, "$(P)$(R)RFRef-Cte")
}

record(ai, "$(P)$(R)FPGAClk-Cte") {
  field(VAL, "124914500")
  field(DESC, "FPGA Clock")
}

record(calc, "$(P)$(R)RFRef-Cte"){
  field(DESC, "RF Ref Input frequency")
  field(PREC, "1")
  field(EGU, "Hz")
  field(INPA, "$(P)$(R)FPGAClk-Cte CPP")
  field(INPB, "$(P)$(R)RFDiv-SP")
  field(CALC, "A*B")
}

record(stringout, "$(P)$(R)IPAddr-Mon"){
  field(DESC, "IPADDR")
  field(VAL, "$(IPADDR)")
}

record(stringout, "$(P)$(R)IPPort-Mon"){
  field(DESC, "IPPORT")
  field(VAL, "$(IPPORT)")
}

########################################################################
# Control and Status Register [0]

record(mbboDirect, "$(P)$(R)RxEnbl-SP") {
  field(DESC, "Each bit sets Rx OUT status")
  field(NOBT, "8")
  field(DTYP, "stream")
  field(OUT, "@timing.proto evg_ctrl_set($(P),$(R)) $(PORT)")
}

record(mbbiDirect, "$(P)$(R)RxEnbl-RB") {
  field(ASG, "Reserved")
  field(DESC, "Each bit shows Rx OUT status")
  field(NOBT, "8")
  field(SCAN, "I/O Intr")
  field(DTYP, "stream")
  field(INP, "@timing.proto evg_ctrl_rxen_intr $(PORT)")
}

record(mbbiDirect, "$(P)$(R)SeqEnblDevEnblRaw") {
  field(ASG, "Reserved")
  field(DESC, "seqen and enable status")
  field(NOBT, "8")
  field(SCAN, "I/O Intr")
  field(DTYP, "stream")
  field(INP, "@timing.proto evg_ctrl_seqen_enable_intr $(PORT)")
  field(FLNK, "$(P)$(R)DevEnbl-Sts")
}

record(bi, "$(P)$(R)DevEnbl-Sts") {
  field(ASG, "Reserved")
  field(DESC, "enable status")
  field(ZNAM, "Dsbl")
  field(ONAM, "Enbl")
  field(INP, "$(P)$(R)SeqEnblDevEnblRaw.B0")
  field(FLNK, "$(P)$(R)SeqEnbl-Sts")
}

record(bi, "$(P)$(R)SeqEnbl-Sts") {
  field(ASG, "Reserved")
  field(DESC, "SEQRAM enable status")
  field(ZNAM, "Dsbl")
  field(ONAM, "Enbl")
  field(INP, "$(P)$(R)SeqEnblDevEnblRaw.B1")
}

record(mbbiDirect, "$(P)$(R)SeqStatusRFStatusRaw") {
  field(ASG, "Reserved")
  field(DESC, "SEQRAM and RF input status")
  field(NOBT, "6")
  field(SHFT, "3")
  field(SCAN, "I/O Intr")
  field(DTYP, "stream")
  field(INP, "@timing.proto evg_ctrl_seqstat_rfstat_intr $(PORT)")
  field(FLNK, "$(P)$(R)RFStatus-Mon")
}

record(bo, "$(P)$(R)RFReset-Cmd") {
  field(DESC, "RF input reset")
  field(ZNAM, "Dsbl")
  field(ONAM, "Enbl")
  field(HIGH, "1")
  field(FLNK, "$(P)$(R)RFDiv-SP.PROC")
}

record(bi, "$(P)$(R)RFStatus-Mon") {
  field(ASG, "Reserved")
  field(DESC, "RF input status")
  field(ZNAM, "Loss or Out of Range")
  field(ONAM, "Normal")
  field(INP, "$(P)$(R)SeqStatusRFStatusRaw.B2")
  field(FLNK, "$(P)$(R)SeqStatusCalc")
}

record(mbbiDirect, "$(P)$(R)Los-Mon") {
  field(DESC, "Downlink status in OUT0-OUT7")
  field(NOBT, "8")
  field(DTYP, "stream")
  field(SCAN, "I/O Intr")
  field(INP, "@timing.proto evg_ctrl_los_intr $(PORT)")
}

record(longin, "$(P)$(R)Freq-Mon") {
  field(DESC, "Frequency")
  field(DTYP, "stream")
  field(SCAN, "I/O Intr")
  field(INP, "@timing.proto evg_ctrl_freq_intr $(PORT)")
}

record(calc, "$(P)$(R)SeqStatusCalc") {
  field(ASG, "Reserved")
  field(DESC, "SEQRAM status calculation")
  field(INPA, "$(P)$(R)SeqStatusRFStatusRaw")
  field(CALC, "A&3")
  field(FLNK, "$(P)$(R)SeqStatus-Mon")
}

record(mbbi, "$(P)$(R)SeqStatus-Mon") {
  field(ASG, "Reserved")
  field(DESC, "SEQRAM status")
  field(INP, "$(P)$(R)SeqStatusCalc")
  field(ZRVL, "0")
  field(ZRST, "Stopped")
  field(ONVL, "1")
  field(ONST, "SEQRAM 1")
  field(TWVL, "2")
  field(TWST, "SEQRAM 2")
}

record(calcout, "$(P)$(R)SeqEnblDevEnblCalc") {
  field(ASG, "Reserved")
  field(DESC, "download SEQEN and ENABLE")
  field(PINI, "1")
  field(INPA, "$(P)$(R)SeqEnbl-Sel")
  field(INPB, "$(P)$(R)DevEnbl-Sel")
  field(CALC, "(A<<1)|B")
}

record(calcout, "$(P)$(R)SEQEN") {
  field(ASG, "Reserved")
  field(DESC, "SEQRAM set enable calc")
  field(DTYP, "stream")
  field(INPA, "$(P)$(R)SeqEnbl-Sel.RVAL")
  field(INPB, "$(P)$(R)DevEnbl-Sts")
  field(CALC, "(A<<1)|B")
  field(OUT, "@timing.proto evg_ctrl_seq_en_set($(P),$(R),SEQEN) $(PORT)")
  field(FLNK, "$(P)$(R)SeqEnblDevEnblCalc")
}

record(calcout, "$(P)$(R)EVGEN") {
  field(ASG, "Reserved")
  field(DESC, "set enable calc")
  field(DTYP, "stream")
  field(INPA, "$(P)$(R)SeqEnbl-Sts")
  field(INPB, "$(P)$(R)DevEnbl-Sel.RVAL")
  field(CALC, "(A<<1)|B")
  field(OUT, "@timing.proto evg_ctrl_seq_en_set($(P),$(R),EVGEN) $(PORT)")
  field(FLNK, "$(P)$(R)SeqEnblDevEnblCalc")
}

record(bo, "$(P)$(R)SeqEnbl-Sel"){
  field(DESC, "Enable/Disable Sequence RAM")
  field(MASK, "1")
  field(ZNAM, "Dsbl")
  field(ONAM, "Enbl")
  field(FLNK, "$(P)$(R)SEQEN")
}

record(bo, "$(P)$(R)DevEnbl-Sel"){
  field(DESC, "Enable/Disable EVG")
  field(MASK, "1")
  field(ZNAM, "Dsbl")
  field(ONAM, "Enbl")
  field(FLNK, "$(P)$(R)EVGEN")
}

record(longout, "$(P)$(R)cmd_ctrl_get") {
  field(ASG, "Reserved")
  field(DESC, "Control Status reg read command code")
  field(VAL, "0x80") # (0x80 | reg number)
  field(SCAN, ".1 second")
  field(DTYP, "stream")
  field(OUT, "@timing.proto evg_ctrl_get($(P),$(R)) $(PORT)")
}

record(longout, "$(P)$(R)cmd_ctrl_set") {
  field(ASG, "Reserved")
  field(DESC, "Control Status reg write command code")
  field(VAL, "0x40")
}

########################################################################
# AC Line register [40]

record(bi, "$(P)$(R)ACEnbl-Sts") {
  field(ASG, "Reserved")
  field(DESC, "Enable/Disable AC line input RBV")
  field(ZNAM, "Dsbl")
  field(ONAM, "Enbl")
}

record(bi, "$(P)$(R)ACSrc-Sts") {
  field(ASG, "Reserved")
  field(DESC, "AC line input source RBV")
  field(ZNAM, "External")
  field(ONAM, "Internal")
}

record(bi, "$(P)$(R)ACStatus-Mon") {
  field(ASG, "Reserved")
  field(DESC, "AC line input status")
  field(ZNAM, "Disconnected")
  field(ONAM, "Connected")
}

record(longin, "$(P)$(R)ACDivRaw") {
  field(ASG, "Reserved")
  field(DESC, "AC line RAW frequency divider")
  field(SCAN, "I/O Intr")
  field(DTYP, "stream")
  field(INP, "@timing.proto evg_acline_acdivraw_intr $(PORT)")
  field(FLNK, "$(P)$(R)ACDiv-RB")
}

record(calc, "$(P)$(R)ACDiv-RB") {
  field(ASG, "Reserved")
  field(DESC, "AC line input divider RBV")
  field(INPA, "$(P)$(R)ACDivRaw")
  field(CALC, "A+1")
  field(FLNK, "$(P)$(R)InjRate-RB")
}

record(calc, "$(P)$(R)InjRate-RB"){
  field(DESC, "Injection rate trigger RBV")
  field(INPA, "$(P)$(R)ACDiv-RB")
  field(CALC, "60/A")
  field(PREC, "0")
  field(EGU, "Hz")
}

record(bo, "$(P)$(R)ACEnbl-Sel"){
  field(DESC, "Enable/Disable AC line input")
  field(MASK, "1")
  field(DTYP, "stream")
  field(ZNAM, "Dsbl")
  field(ONAM, "Enbl")
  field(OUT, "@timing.proto evg_acline_set($(P),$(R)) $(PORT)")
}

record(bo, "$(P)$(R)ACSrc-Sel"){
  field(DESC, "AC line input source")
  field(MASK, "1")
  field(DTYP, "stream")
  field(ZNAM, "External")
  field(ONAM, "Internal")
  field(OUT, "@timing.proto evg_acline_set($(P),$(R)) $(PORT)")
}

record(ao, "$(P)$(R)InjRate-SP"){
  field(DESC, "Injection rate trigger")
  field(PINI, "1")
  field(DRVH, "10")
  field(DRVL, "1")
  field(PREC, "0")
  field(EGU, "Hz")
  field(VAL, "2")
  field(FLNK, "$(P)$(R)InjRateCalc")
}

record(calcout, "$(P)$(R)InjRateCalc"){
  field(DESC, "Injection rate trigger calcout")
  field(INPA, "$(P)$(R)InjRate-SP")
  field(CALC, "60/A")
  field(PREC, "0")
  field(OUT, "$(P)$(R)ACDiv-SP PP")
}

record(ao, "$(P)$(R)ACDiv-SP"){
  field(DESC, "AC line input divider")
  field(DTYP, "stream")
  field(DRVH, "60")
  field(DRVL, "1")
  field(AOFF, "1")
  field(PREC, "0")
  field(OUT, "@timing.proto evg_acline_set($(P),$(R)) $(PORT)")
}

record(longout, "$(P)$(R)cmd_acdiv_get") {
  field(ASG, "Reserved")
  field(SCAN, "1 second")
  field(DESC, "AC Line reg read command code")
  field(DTYP, "stream")
  field(VAL, "0xA8") # (0x80 | reg number=40)
  field(OUT, "@timing.proto evg_acline_get($(P),$(R)) $(PORT)")
}

record(longout, "$(P)$(R)cmd_acdiv_set") {
  field(ASG, "Reserved")
  field(DESC, "AC Line reg write command code")
  field(VAL, "0x68")
}

########################################################################
# SEQRAM setting register [49]

record(longout, "$(P)$(R)SeqAddr-SP"){
  field(DESC, "Set address of SEQRAM")
  field(DRVH, "16383")
  field(DRVL, "0")
}

record(longout, "$(P)$(R)SeqCode-SP"){
  field(DESC, "Set event code in SEQRAM")
  field(DRVH, "255")
  field(DRVL, "0")
}

record(longout, "$(P)$(R)SeqTime-SP"){
  field(DESC, "Set timestamp in SEQRAM")
  field(DTYP, "stream")
  field(OUT, "@timing.proto evg_seqramset_set($(P),$(R)) $(PORT)")
}

record(longout, "$(P)$(R)cmd_seqram_set") {
  field(ASG, "Reserved")
  field(DESC, "SEQRAM setting reg write command code")
  field(VAL, "0x71")
}

########################################################################
# SEQRAM switch register [50]

record(mbbiDirect, "$(P)$(R)SeqCount-SP") {
  field(ASG, "Reserved")
  field(DESC, "seqcount status")
  field(NOBT, "14")
  field(DTYP, "stream")
  field(INP, "@timing.proto evg_seqramsw_get($(P),$(R)) $(PORT)")
}

record(longin, "$(P)$(R)TotalInjCount-Mon") {
  field(DESC, "Total injection counter")
  field(SCAN, "I/O Intr")
  field(DTYP, "stream")
  field(INP, "@timing.proto evg_totalinjcount_intr($(P),$(R)) $(PORT)")
}

record(longin, "$(P)$(R)InjCount-Mon") {
  field(DESC, "Injection counter")
  field(SCAN, "I/O Intr")
  field(DTYP, "stream")
  field(INP, "@timing.proto evg_injcount_intr($(P),$(R)) $(PORT)")
}

record(longout, "$(P)$(R)SeqSw-Cmd"){
  field(DESC, "Switch SEQRAM")
  field(DTYP, "stream")
  field(OUT, "@timing.proto evg_seqramsw_set($(P),$(R)) $(PORT)")
}

record(longout, "$(P)$(R)cmd_seqramsw_get") {
  field(ASG, "Reserved")
  field(SCAN, ".01 second")
  field(DESC, "SEQRAM switch reg read command code")
  field(VAL, "0xB2") # (0x80 | reg number=50)
  field(DTYP, "stream")
  field(OUT, "@timing.proto evg_seqramsw_get($(P),$(R)) $(PORT)")
}

record(longout, "$(P)$(R)cmd_seqramsw_set") {
  field(ASG, "Reserved")
  field(DESC, "SEQRAM switch reg write command code")
  field(VAL, "0x72")
}

########################################################################
# Timestamp register [51]

# This record value is read by the Sequencer program sncEVGSetup
record(bo, "$(P)$(R)UTCRefSrc-Sel"){
  field(DESC, "UTC reference")
  field(MASK, "1")
  field(ZNAM, "PC")
  field(ONAM, "Control Room")
}

# This record value is written by the Sequencer program sncEVGSetup
record(bi, "$(P)$(R)UTCMismatch-Mon"){
  field(ASG, "Reserved")
  field(DESC, "UTC mismatch between ref. and EVG")
  field(ZNAM, "Match")
  field(ONAM, "Mismatch")
}

# This record value is read by the Sequencer program sncEVGSetup
record(bo, "$(P)$(R)GetUTC-Cmd"){
  field(DESC, "Get UTC from configured reference cmd")
  field(MASK, "1")
  field(ZNAM, "Dsbl")
  field(ONAM, "Enbl")
}

# This record monitors the control room timestamp
record(longin, "$(P)$(R)CtrlRoomUTC"){
  field(ASG, "Reserved")
  field(DESC, "Control room UTC monitor")
  field(INP, "Cont:LNLS191:NTP:Timestamp CPP")
  field(EGU, "seconds")
}

# Note: Setting $(P)$(R)UTC.VAL to 0 causes a broadcast
# 	the timestamp to the EVEs and EVRs.

record(longout, "$(P)$(R)UTC-SP"){
  field(DESC, "timestamp UTC field")
  field(EGU, "seconds")
  field(DTYP, "stream")
  field(OUT, "@timing.proto evg_tmstmp_utc_set($(P),$(R)) $(PORT)")
}

record(mbbo, "$(P)$(R)TimestampSrc-Sel"){
  field(DESC, "timestamp signal source")	
  field(ZRST, "IDLE")
  field(ZRVL, "0")
  field(ONST, "DBUS")
  field(ONVL, "1")
  field(TWST, "EXTERNAL")
  field(TWVL, "2")
  field(THST, "INTERNAL")
  field(THVL, "3")
  field(VAL, "0")
  field(DTYP, "stream")
  field(OUT, "@timing.proto evg_tmstmp_timesrc_set($(P),$(R)) $(PORT)")
}

record(longin, "$(P)$(R)UTC-RB"){
  field(ASG, "Reserved")
  field(DESC, "timestamp UTC field RBV")
  field(EGU, "seconds")
}

record(longin, "$(P)$(R)SubSecond-Mon"){
  field(ASG, "Reserved")
  field(DESC, "timestamp subsecond field RBV")
  field(EGU, "evt_T")
}

record(mbbi, "$(P)$(R)TimestampSrc-Sts"){
  field(ASG, "Reserved")
  field(DESC, "timestamp signal source RBV")	
  field(ZRST, "IDLE")
  field(ZRVL, "0")
  field(ONST, "DBUS")
  field(ONVL, "1")
  field(TWST, "EXTERNAL")
  field(TWVL, "2")
  field(THST, "INTERNAL")
  field(THVL, "3")
  field(SCAN, "I/O Intr")
  field(DTYP, "stream")
  field(INP, "@timing.proto evg_tmstmp_timesrcRBV_intr $(PORT)")
}

record(longout, "$(P)$(R)cmd_tmstmp_get"){
  field(ASG, "Reserved")
  field(DESC, "Timestamp reg read command code")
  field(VAL, "0xB3")
  field(SCAN, "1 second")
  field(DTYP, "stream")
  field(OUT, "@timing.proto evg_tmstmp_get($(P),$(R)) $(PORT)")
}

record(longout, "$(P)$(R)cmd_tmstmp_set"){
  field(ASG, "Reserved")
  field(DESC, "Timestamp reg write command code")
  field(VAL, "0x73")
}

########################################################################
# Digital input 0 [53]

record(longout, "$(P)$(R)DIEvent0-SP") {
  field(DESC, "digital input 0 event code")
  field(DRVH, "255")
  field(DRVL, "0")
  field(DTYP, "stream")
  field(OUT, "@timing.proto evgre_diginp_ev_set($(P),$(R),0) $(PORT)")
}

record(bo, "$(P)$(R)DIEnbl0-Sel") {
  field(DESC, "digital input 0 enable")
  field(MASK, "1")
  field(ZNAM, "Dsbl")
  field(ONAM, "Enbl")
  field(FLNK, "$(P)$(R)DIEnblCalc0")
}

record(bo, "$(P)$(R)DIPol0-Sel") {
  field(DESC, "digital input 0 polarity")
  field(MASK, "1")
  field(ZNAM, "Normal")
  field(ONAM, "Inverse")
  field(FLNK, "$(P)$(R)DIPolCalc0")
}

record(bo, "$(P)$(R)DILog0-Sel") {
  field(DESC, "dig. input 0 event timestamp enable")
  field(MASK, "1")
  field(ZNAM, "Dsbl")
  field(ONAM, "Enbl")
  field(FLNK, "$(P)$(R)DILogCalc0")
}

record(calcout, "$(P)$(R)DIEnblCalc0") {
  field(ASG, "Reserved")
  field(DESC, "digital input 0 set enable calc")
  field(DTYP, "stream")
  field(INPA, "$(P)$(R)DIEnbl0-Sel.VAL")
  field(INPB, "$(P)$(R)DIPol0-Sts.VAL")
  field(INPC, "$(P)$(R)DILog0-Sts.VAL")
  field(CALC, "(A<<7)|(B<<6)|(C<<5)")
  field(OUT, "@timing.proto evgre_diginp_ept_set($(P),$(R),0,DIEnblCalc) $(PORT)")
  field(FLNK, "$(P)$(R)DI0Calc")
}

record(calcout, "$(P)$(R)DIPolCalc0") {
  field(ASG, "Reserved")
  field(DESC, "digital input 0 set polarity calc")
  field(DTYP, "stream")
  field(INPA, "$(P)$(R)DIEnbl0-Sts.VAL")
  field(INPB, "$(P)$(R)DIPol0-Sel.VAL")
  field(INPC, "$(P)$(R)DILog0-Sts.VAL")
  field(CALC, "(A<<7)|(B<<6)|(C<<5)")
  field(OUT, "@timing.proto evgre_diginp_ept_set($(P),$(R),0,DIPolCalc) $(PORT)")
  field(FLNK, "$(P)$(R)DI0Calc")
}

record(calcout, "$(P)$(R)DILogCalc0") {
  field(ASG, "Reserved")
  field(DESC, "digital input 0 set timestamp calc")
  field(DTYP, "stream")
  field(INPA, "$(P)$(R)DIEnbl0-Sts.VAL")
  field(INPB, "$(P)$(R)DIPol0-Sts.VAL")
  field(INPC, "$(P)$(R)DILog0-Sel.VAL")
  field(CALC, "(A<<7)|(B<<6)|(C<<5)")
  field(OUT, "@timing.proto evgre_diginp_ept_set($(P),$(R),0,DILogCalc) $(PORT)")
  field(FLNK, "$(P)$(R)DI0Calc")
}

record(calcout, "$(P)$(R)DI0Calc") {
  field(ASG, "Reserved")
  field(DESC, "dig.inp. 0 download en, pol and time")
  field(INPA, "$(P)$(R)DIEnbl0-Sel.VAL")
  field(INPB, "$(P)$(R)DIPol0-Sel.VAL")
  field(INPC, "$(P)$(R)DILog0-Sel.VAL")
  field(CALC, "(A<<7)|(B<<6)|(C<<5)")
}

record(mbbiDirect, "$(P)$(R)DI0Raw") {
  field(ASG, "Reserved")
  field(DESC, "DIGINP0 en, pol, and timestamp RBV")
  field(NOBT, "8")
  field(SHFT, "5")
  field(SCAN, "I/O Intr")
  field(DTYP, "stream")
  field(INP, "@timing.proto evgre_diginp0_intr $(PORT)")
  field(FLNK, "$(P)$(R)DILog0-Sts")
}

record(bi, "$(P)$(R)DILog0-Sts") {
  field(ASG, "Reserved")
  field(DESC, "digital input 0 timestamping sts")
  field(ZNAM, "Dsbl")
  field(ONAM, "Enbl")
  field(INP, "$(P)$(R)DI0Raw.B0")
  field(FLNK, "$(P)$(R)DIPol0-Sts")
}

record(bi, "$(P)$(R)DIPol0-Sts") {
  field(ASG, "Reserved")
  field(DESC, "digital input 0 polarity status")
  field(ZNAM, "Normal")
  field(ONAM, "Inverse")
  field(INP, "$(P)$(R)DI0Raw.B1")
  field(FLNK, "$(P)$(R)DIEnbl0-Sts")
}

record(bi, "$(P)$(R)DIEnbl0-Sts") {
  field(ASG, "Reserved")
  field(DESC, "digital input 0 enable status")
  field(ZNAM, "Dsbl")
  field(ONAM, "Enbl")
  field(INP, "$(P)$(R)DI0Raw.B2")
}

record(longin, "$(P)$(R)DIEvent0-RB") {
  field(ASG, "Reserved")
  field(DESC, "digital input 0 event RBV")
}

record(longout, "$(P)$(R)cmd_diginp_set0") {
  field(ASG, "Reserved")
  field(DESC, "Command code to write to DIGINP0")
  field(VAL, "0x75") # (0x40 | reg number=1)
}

record(longout, "$(P)$(R)cmd_diginp_get0") {
  field(ASG, "Reserved")
  field(DESC, "Command code to read DIGINP0")
  field(VAL, "0xB5") # (0x80 | reg number=1)
}

########################################################################
# Digital input 1 [54]

record(longout, "$(P)$(R)DIEvent1-SP") {
  field(DESC, "digital input 1 event code")
  field(DRVH, "255")
  field(DRVL, "0")
  field(DTYP, "stream")
  field(OUT, "@timing.proto evgre_diginp_ev_set($(P),$(R),1) $(PORT)")
}

record(bo, "$(P)$(R)DIEnbl1-Sel") {
  field(DESC, "digital input 1 enable")
  field(MASK, "1")
  field(ZNAM, "Dsbl")
  field(ONAM, "Enbl")
  field(FLNK, "$(P)$(R)DIEnblCalc1")
}

record(bo, "$(P)$(R)DIPol1-Sel") {
  field(DESC, "digital input 1 polarity")
  field(MASK, "1")
  field(ZNAM, "Normal")
  field(ONAM, "Inverse")
  field(FLNK, "$(P)$(R)DIPolCalc1")
}

record(bo, "$(P)$(R)DILog1-Sel") {
  field(DESC, "dig. input 1 event timestamp enable")
  field(MASK, "1")
  field(ZNAM, "Dsbl")
  field(ONAM, "Enbl")
  field(FLNK, "$(P)$(R)DILogCalc1")
}

record(calcout, "$(P)$(R)DIEnblCalc1") {
  field(ASG, "Reserved")
  field(DESC, "digital input 1 set enable calc")
  field(DTYP, "stream")
  field(INPA, "$(P)$(R)DIEnbl1-Sel.VAL")
  field(INPB, "$(P)$(R)DIPol1-Sts.VAL")
  field(INPC, "$(P)$(R)DILog1-Sts.VAL")
  field(CALC, "(A<<7)|(B<<6)|(C<<5)")
  field(OUT, "@timing.proto evgre_diginp_ept_set($(P),$(R),1,DIEnblCalc) $(PORT)")
  field(FLNK, "$(P)$(R)DI1Calc")
}

record(calcout, "$(P)$(R)DIPolCalc1") {
  field(ASG, "Reserved")
  field(DESC, "digital input 1 set polarity calc")
  field(DTYP, "stream")
  field(INPA, "$(P)$(R)DIEnbl1-Sts.VAL")
  field(INPB, "$(P)$(R)DIPol1-Sel.VAL")
  field(INPC, "$(P)$(R)DILog1-Sts.VAL")
  field(CALC, "(A<<7)|(B<<6)|(C<<5)")
  field(OUT, "@timing.proto evgre_diginp_ept_set($(P),$(R),1,DIPolCalc) $(PORT)")
  field(FLNK, "$(P)$(R)DI1Calc")
}

record(calcout, "$(P)$(R)DILogCalc1") {
  field(ASG, "Reserved")
  field(DESC, "digital input 1 set timestamp calc")
  field(DTYP, "stream")
  field(INPA, "$(P)$(R)DIEnbl1-Sts.VAL")
  field(INPB, "$(P)$(R)DIPol1-Sts.VAL")
  field(INPC, "$(P)$(R)DILog1-Sel.VAL")
  field(CALC, "(A<<7)|(B<<6)|(C<<5)")
  field(OUT, "@timing.proto evgre_diginp_ept_set($(P),$(R),1,DILogCalc) $(PORT)")
  field(FLNK, "$(P)$(R)DI1Calc")
}

record(calcout, "$(P)$(R)DI1Calc") {
  field(ASG, "Reserved")
  field(DESC, "dig.inp. 1 download en, pol and time")
  field(INPA, "$(P)$(R)DIEnbl1-Sel.VAL")
  field(INPB, "$(P)$(R)DIPol1-Sel.VAL")
  field(INPC, "$(P)$(R)DILog1-Sel.VAL")
  field(CALC, "(A<<7)|(B<<6)|(C<<5)")
}

record(mbbiDirect, "$(P)$(R)DI1Raw") {
  field(ASG, "Reserved")
  field(DESC, "DIGINP1 en, pol, and timestamp RBV")
  field(NOBT, "8")
  field(SHFT, "5")
  field(SCAN, "I/O Intr")
  field(DTYP, "stream")
  field(INP, "@timing.proto evgre_diginp1_intr $(PORT)")
  field(FLNK, "$(P)$(R)DILog1-Sts")
}

record(bi, "$(P)$(R)DILog1-Sts") {
  field(ASG, "Reserved")
  field(DESC, "digital input 1 timestamping sts")
  field(ZNAM, "Dsbl")
  field(ONAM, "Enbl")
  field(INP, "$(P)$(R)DI1Raw.B0")
  field(FLNK, "$(P)$(R)DIPol1-Sts")
}

record(bi, "$(P)$(R)DIPol1-Sts") {
  field(ASG, "Reserved")
  field(DESC, "digital input 1 polarity status")
  field(ZNAM, "Normal")
  field(ONAM, "Inverse")
  field(INP, "$(P)$(R)DI1Raw.B1")
  field(FLNK, "$(P)$(R)DIEnbl1-Sts")
}

record(bi, "$(P)$(R)DIEnbl1-Sts") {
  field(ASG, "Reserved")
  field(DESC, "digital input 1 enable status")
  field(ZNAM, "Dsbl")
  field(ONAM, "Enbl")
  field(INP, "$(P)$(R)DI1Raw.B2")
}

record(longin, "$(P)$(R)DIEvent1-RB") {
  field(ASG, "Reserved")
  field(DESC, "digital input 1 event RBV")
}

record(longout, "$(P)$(R)cmd_diginp_set1") {
  field(ASG, "Reserved")
  field(DESC, "Command code to write to DIGINP1")
  field(VAL, "0x76") # (0x40 | reg number=1)
}

record(longout, "$(P)$(R)cmd_diginp_get1") {
  field(ASG, "Reserved")
  field(DESC, "Command code to read DIGINP1")
  field(VAL, "0xB6") # (0x80 | reg number=1)
}

########################################################################
# Interlock map [56]

record(mbboDirect, "$(P)$(R)ilock_mbbo") {
  field(DESC, "interlock input to output map")
}

record(mbbiDirect, "$(P)$(R)ilock_mbbi") {
  field(DESC, "interlock input to output map")
  field(VAL, "1")
}

record(seq, "$(P)$(R)ilock_seq1") {
  field(DESC, "interlock input to output map")
  field(DOL1, "$(P)$(R)IntlkTbl0to15-Sts.B0")
  field(DOL2, "$(P)$(R)IntlkTbl0to15-Sts.B1")
  field(DOL3, "$(P)$(R)IntlkTbl0to15-Sts.B2")
  field(DOL4, "$(P)$(R)IntlkTbl0to15-Sts.B3")
  field(DOL5, "$(P)$(R)IntlkTbl0to15-Sts.B4")
  field(DOL6, "$(P)$(R)IntlkTbl0to15-Sts.B5")
  field(DOL7, "$(P)$(R)IntlkTbl0to15-Sts.B6")
  field(DOL8, "$(P)$(R)IntlkTbl0to15-Sts.B7")
  field(DOL9, "$(P)$(R)IntlkTbl0to15-Sts.B8")
  field(DOLA, "$(P)$(R)IntlkTbl0to15-Sts.B9")
  field(LNK1, "$(P)$(R)IntlkTbl0to15-Sel.B0")
  field(LNK2, "$(P)$(R)IntlkTbl0to15-Sel.B1")
  field(LNK3, "$(P)$(R)IntlkTbl0to15-Sel.B2")
  field(LNK4, "$(P)$(R)IntlkTbl0to15-Sel.B3")
  field(LNK5, "$(P)$(R)IntlkTbl0to15-Sel.B4")
  field(LNK6, "$(P)$(R)IntlkTbl0to15-Sel.B5")
  field(LNK7, "$(P)$(R)IntlkTbl0to15-Sel.B6")
  field(LNK8, "$(P)$(R)IntlkTbl0to15-Sel.B7")
  field(LNK9, "$(P)$(R)IntlkTbl0to15-Sel.B8")
  field(LNKA, "$(P)$(R)IntlkTbl0to15-Sel.B9")
  field(FLNK, "$(P)$(R)ilock_seq2")
}

record(seq, "$(P)$(R)ilock_seq2") {
  field(DESC, "interlock input to output map")
  field(DOL1, "$(P)$(R)IntlkTbl0to15-Sts.BA")
  field(DOL2, "$(P)$(R)IntlkTbl0to15-Sts.BB")
  field(DOL3, "$(P)$(R)IntlkTbl0to15-Sts.BC")
  field(DOL4, "$(P)$(R)IntlkTbl0to15-Sts.BD")
  field(DOL5, "$(P)$(R)IntlkTbl0to15-Sts.BE")
  field(DOL6, "$(P)$(R)IntlkTbl0to15-Sts.BF")
  field(LNK1, "$(P)$(R)IntlkTbl0to15-Sel.BA")
  field(LNK2, "$(P)$(R)IntlkTbl0to15-Sel.BB")
  field(LNK3, "$(P)$(R)IntlkTbl0to15-Sel.BC")
  field(LNK4, "$(P)$(R)IntlkTbl0to15-Sel.BD")
  field(LNK5, "$(P)$(R)IntlkTbl0to15-Sel.BE")
  field(LNK6, "$(P)$(R)IntlkTbl0to15-Sel.BF")
}

record(seq, "$(P)$(R)ilock_seq3") {
  field(DESC, "interlock input to output map")
  field(DOL1, "$(P)$(R)IntlkTbl16to27-Sts.B0")
  field(DOL2, "$(P)$(R)IntlkTbl16to27-Sts.B1")
  field(DOL3, "$(P)$(R)IntlkTbl16to27-Sts.B2")
  field(DOL4, "$(P)$(R)IntlkTbl16to27-Sts.B3")
  field(DOL5, "$(P)$(R)IntlkTbl16to27-Sts.B4")
  field(DOL6, "$(P)$(R)IntlkTbl16to27-Sts.B5")
  field(DOL7, "$(P)$(R)IntlkTbl16to27-Sts.B6")
  field(DOL8, "$(P)$(R)IntlkTbl16to27-Sts.B7")
  field(DOL9, "$(P)$(R)IntlkTbl16to27-Sts.B8")
  field(DOLA, "$(P)$(R)IntlkTbl16to27-Sts.B9")
  field(LNK1, "$(P)$(R)IntlkTbl16to27-Sel.B0")
  field(LNK2, "$(P)$(R)IntlkTbl16to27-Sel.B1")
  field(LNK3, "$(P)$(R)IntlkTbl16to27-Sel.B2")
  field(LNK4, "$(P)$(R)IntlkTbl16to27-Sel.B3")
  field(LNK5, "$(P)$(R)IntlkTbl16to27-Sel.B4")
  field(LNK6, "$(P)$(R)IntlkTbl16to27-Sel.B5")
  field(LNK7, "$(P)$(R)IntlkTbl16to27-Sel.B6")
  field(LNK8, "$(P)$(R)IntlkTbl16to27-Sel.B7")
  field(LNK9, "$(P)$(R)IntlkTbl16to27-Sel.B8")
  field(LNKA, "$(P)$(R)IntlkTbl16to27-Sel.B9")
  field(FLNK, "$(P)$(R)ilock_seq4")
}

record(seq, "$(P)$(R)ilock_seq4") {
  field(DESC, "interlock input to output map")
  field(DOL1, "$(P)$(R)IntlkTbl16to27-Sts.BA")
  field(DOL2, "$(P)$(R)IntlkTbl16to27-Sts.BB")
  field(LNK1, "$(P)$(R)IntlkTbl16to27-Sel.BA")
  field(LNK2, "$(P)$(R)IntlkTbl16to27-Sel.BB")
}

record(mbboDirect, "$(P)$(R)IntlkTbl0to15-Sel") {
  field(DESC, "interlock input to output map")
  field(FLNK, "$(P)$(R)IntlkTblCalc")
}

record(mbboDirect, "$(P)$(R)IntlkTbl16to27-Sel") {
  field(DESC, "interlock input to output map")
  field(FLNK, "$(P)$(R)IntlkTblCalc")
}

record(calcout, "$(P)$(R)IntlkTblCalc") {
  #field(ASG, "Reserved")
  field(DESC, "interlock map calc")
  field(DTYP, "stream")
  field(INPA, "$(P)$(R)IntlkTbl16to27-Sel")
  field(INPB, "$(P)$(R)IntlkTbl0to15-Sel")
  field(CALC, "(A<<16)+B")
  field(OUT, "@timing.proto evg_ilockmap_map_set($(P),$(R)) $(PORT)")
}

record(longout, "$(P)$(R)IntlkEvtIn0-SP") {
  field(DESC, "interlock input 0 event code")
  field(DRVH, "255")
  field(DRVL, "0")
  field(DTYP, "stream")
  field(OUT, "@timing.proto evg_ilockmap_ev0_set($(P),$(R)) $(PORT)")
}

record(longout, "$(P)$(R)IntlkEvtIn1-SP") {
  field(DESC, "interlock input 1 event code")
  field(DRVH, "255")
  field(DRVL, "0")
  field(DTYP, "stream")
  field(OUT, "@timing.proto evg_ilockmap_ev1_set($(P),$(R)) $(PORT)")
}

record(longout, "$(P)$(R)IntlkEvtIn2-SP") {
  field(DESC, "interlock input 2 event code")
  field(DRVH, "255")
  field(DRVL, "0")
  field(DTYP, "stream")
  field(OUT, "@timing.proto evg_ilockmap_ev2_set($(P),$(R)) $(PORT)")
}

record(longout, "$(P)$(R)IntlkEvtIn3-SP") {
  field(DESC, "interlock input 3 event code")
  field(DRVH, "255")
  field(DRVL, "0")
  field(DTYP, "stream")
  field(OUT, "@timing.proto evg_ilockmap_ev3_set($(P),$(R)) $(PORT)")
}

record(longout, "$(P)$(R)IntlkEvtIn4-SP") {
  field(DESC, "interlock input 4 event code")
  field(DRVH, "255")
  field(DRVL, "0")
  field(DTYP, "stream")
  field(OUT, "@timing.proto evg_ilockmap_ev4_set($(P),$(R)) $(PORT)")
}

record(longout, "$(P)$(R)IntlkEvtIn5-SP") {
  field(DESC, "interlock input 5 event code")
  field(DRVH, "255")
  field(DRVL, "0")
  field(DTYP, "stream")
  field(OUT, "@timing.proto evg_ilockmap_ev5_set($(P),$(R)) $(PORT)")
}

record(longout, "$(P)$(R)IntlkEvtIn6-SP") {
  field(DESC, "interlock input 6 event code")
  field(DRVH, "255")
  field(DRVL, "0")
  field(DTYP, "stream")
  field(OUT, "@timing.proto evg_ilockmap_ev6_set($(P),$(R)) $(PORT)")
}

record(longout, "$(P)$(R)IntlkEvtOut-SP") {
  field(DESC, "interlock output event code")
  field(DRVH, "255")
  field(DRVL, "0")
  field(DTYP, "stream")
  field(OUT, "@timing.proto evg_ilockmap_evout_set($(P),$(R)) $(PORT)")
}

record(longout, "$(P)$(R)cmd_evg_ilockmap_set") {
  field(ASG, "Reserved")
  field(DESC, "Command code to write to Interlock Map")
  field(VAL, "0x78")
}

record(longout, "$(P)$(R)cmd_evg_ilockmap_get") {
  field(ASG, "Reserved")
  field(DESC, "Command code to read Interlock Map")
  field(VAL, "0xB8")
}

record(mbbiDirect, "$(P)$(R)IntlkTbl0to15-Sts") {
  field(DESC, "interlock input to output map RBV")
  field(FLNK, "$(P)$(R)ilock_seq1")
}

record(mbbiDirect, "$(P)$(R)IntlkTbl16to27-Sts") {
  field(DESC, "interlock input to output map RBV")
  field(FLNK, "$(P)$(R)ilock_seq3")
}

record(longin, "$(P)$(R)IntlkEvtIn0-RB") {
  field(ASG, "Reserved")
  field(DESC, "interlock input 0 event code RBV")
}

record(longin, "$(P)$(R)IntlkEvtIn1-RB") {
  field(ASG, "Reserved")
  field(DESC, "interlock input 1 event code RBV")
}

record(longin, "$(P)$(R)IntlkEvtIn2-RB") {
  field(ASG, "Reserved")
  field(DESC, "interlock input 2 event code RBV")
}

record(longin, "$(P)$(R)IntlkEvtIn3-RB") {
  field(ASG, "Reserved")
  field(DESC, "interlock input 3 event code RBV")
}

record(longin, "$(P)$(R)IntlkEvtIn4-RB") {
  field(ASG, "Reserved")
  field(DESC, "interlock input 4 event code RBV")
}

record(longin, "$(P)$(R)IntlkEvtIn5-RB") {
  field(ASG, "Reserved")
  field(DESC, "interlock input 5 event code RBV")
}

record(longin, "$(P)$(R)IntlkEvtIn6-RB") {
  field(ASG, "Reserved")
  field(DESC, "interlock input 6 event code RBV")
}

record(longin, "$(P)$(R)IntlkEvtOut-RB") {
  field(ASG, "Reserved")
  field(DESC, "interlock output event code RBV")
}

########################################################################
# Interlock Control and Status [57]

record(longout, "$(P)$(R)cmd_evg_ilockcontrol_set") {
  field(ASG, "Reserved")
  field(DESC, "Command code to write Interlock Control")
  field(VAL, "0x79")
}

record(longout, "$(P)$(R)cmd_evg_ilockcontrol_get") {
  field(ASG, "Reserved")
  field(DESC, "Command code to read Interlock Control")
  field(SCAN, "1 second")
  field(VAL, "0xB9")
  field(DTYP, "stream")
  field(OUT, "@timing.proto evg_ilockcontrol_get($(P),$(R)) $(PORT)")
}

record(bo, "$(P)$(R)IntlkCtrlEnbl-Sel") {
  field(DESC, "Interlock map enable")
  field(MASK, "1")
  field(ZNAM, "Dsbl")
  field(ONAM, "Enbl")
  field(FLNK, "$(P)$(R)IntlkCtrlEnblCalc")
}

record(bo, "$(P)$(R)IntlkCtrlRst-Sel") {
  field(DESC, "Interlock map reset")
  field(MASK, "1")
  field(ZNAM, "Dsbl")
  field(ONAM, "Enbl")
  field(HIGH, "1")
  field(FLNK, "$(P)$(R)IntlkCtrlRstCalc")
}

record(bo, "$(P)$(R)IntlkCtrlRepeat-Sel") {
  field(DESC, "Interlock map enable continuous mode")
  field(MASK, "1")
  field(ZNAM, "Dsbl")
  field(ONAM, "Enbl")
  field(FLNK, "$(P)$(R)IntlkCtrlRepeatCalc")
}

record(calcout, "$(P)$(R)IntlkCtrlEnblCalc") {
  field(ASG, "Reserved")
  field(DESC, "Interlock control. En, reset, cont.")
  field(INPA, "$(P)$(R)IntlkCtrlEnbl-Sel")
  field(INPB, "$(P)$(R)IntlkCtrlRst-Sts")
  field(INPC, "$(P)$(R)IntlkCtrlRepeat-Sts")
  field(CALC, "(A<<7)|(B<<6)|(C<<5)")
  field(DTYP, "stream")
  field(OUT, "@timing.proto evg_ilockcontrol_set($(P),$(R),EnblCalc) $(PORT)")
  field(FLNK, "$(P)$(R)IntlkCtrlCalc")
}

record(calcout, "$(P)$(R)IntlkCtrlRstCalc") {
  field(ASG, "Reserved")
  field(DESC, "Interlock control. En, reset, cont.")
  field(INPA, "$(P)$(R)IntlkCtrlEnbl-Sts")
  field(INPB, "$(P)$(R)IntlkCtrlRst-Sel")
  field(INPC, "$(P)$(R)IntlkCtrlRepeat-Sts")
  field(CALC, "(A<<7)|(B<<6)|(C<<5)")
  field(DTYP, "stream")
  field(OUT, "@timing.proto evg_ilockcontrol_set($(P),$(R),RstCalc) $(PORT)")
  field(FLNK, "$(P)$(R)IntlkCtrlCalc")
}

record(calcout, "$(P)$(R)IntlkCtrlRepeatCalc") {
  field(ASG, "Reserved")
  field(DESC, "Interlock control. En, reset, cont.")
  field(INPA, "$(P)$(R)IntlkCtrlEnbl-Sts")
  field(INPB, "$(P)$(R)IntlkCtrlRst-Sts")
  field(INPC, "$(P)$(R)IntlkCtrlRepeat-Sel")
  field(CALC, "(A<<7)|(B<<6)|(C<<5)")
  field(DTYP, "stream")
  field(OUT, "@timing.proto evg_ilockcontrol_set($(P),$(R),RepeatCalc) $(PORT)")
  field(FLNK, "$(P)$(R)IntlkCtrlCalc")
}

record(calcout, "$(P)$(R)IntlkCtrlCalc") {
  field(ASG, "Reserved")
  field(DESC, "Interlock control. En, reset, cont.")
  field(INPA, "$(P)$(R)IntlkCtrlEnbl-Sel")
  field(INPB, "$(P)$(R)IntlkCtrlRst-Sel")
  field(INPC, "$(P)$(R)IntlkCtrlRepeat-Sel")
  field(CALC, "(A<<7)|(B<<6)|(C<<5)")
}

record(longout, "$(P)$(R)IntlkCtrlRepeatTime-SP") {
  field(DESC, "Interlock event output repeat time")
  field(DRVH, "4294967295")
  field(DRVL, "1")
  field(DTYP, "stream")
  field(OUT, "@timing.proto evg_ilockrepeat_time_set($(P),$(R)) $(PORT)")
}

record(longin, "$(P)$(R)IntlkCtrlRepeatTime-RB") {
  #field(ASG, "Reserved")
  field(DESC, "Interlock evtout repeat time RBV")
  field(SCAN, "I/O Intr")
  field(DTYP, "stream")
  field(INP, "@timing.proto evg_ilock_repeat_time_intr $(PORT)")
}

record(mbbiDirect, "$(P)$(R)IntlkCtrlRaw") {
  #field(ASG, "Reserved")
  field(DESC, "Interlock control RBV.")
  field(NOBT, "8")
  field(SCAN, "I/O Intr")
  field(DTYP, "stream")
  field(INP, "@timing.proto evg_ilock_control_intr $(PORT)")
  field(FLNK, "$(P)$(R)IntlkCtrlEnbl-Sts")
}

record(bi, "$(P)$(R)IntlkCtrlEnbl-Sts") {
  field(DESC, "Interlock map enable RBV")
  field(ZNAM, "Dsbl")
  field(ONAM, "Enbl")
  field(INP, "$(P)$(R)IntlkCtrlRaw.B7")
  field(FLNK, "$(P)$(R)IntlkCtrlRst-Sts")
}

record(bi, "$(P)$(R)IntlkCtrlRst-Sts") {
  field(DESC, "Interlock map reset RBV")
  field(ZNAM, "Dsbl")
  field(ONAM, "Enbl")
  field(INP, "$(P)$(R)IntlkCtrlRaw.B6")
  field(FLNK, "$(P)$(R)IntlkCtrlRepeat-Sts")
}

record(bi, "$(P)$(R)IntlkCtrlRepeat-Sts") {
  field(DESC, "Interlock map enable continuous mode RBV")
  field(ZNAM, "Dsbl")
  field(ONAM, "Enbl")
  field(INP, "$(P)$(R)IntlkCtrlRaw.B5")
}

record(mbbiDirect, "$(P)$(R)IntlkEvtStatus-Mon") {
  #field(ASG, "Reserved")
  field(DESC, "Interlock event status")
  field(NOBT, "8")
  field(SCAN, "I/O Intr")
  field(DTYP, "stream")
  field(INP, "@timing.proto evg_ilock_status_intr $(PORT)")
}

########################################################################
# Firmware Version [62]

record(longin, "$(P)$(R)FrmVersionA-Cte"){
  #field(ASG, "Reserved")
  field(DESC, "EVO firmware version")
  field(DTYP, "stream")
  field(INP, "@timing.proto frmvrs_get($(P),$(R)) $(PORT)")
}

record(longin, "$(P)$(R)FrmVersionB-Cte"){
  #field(ASG, "Reserved")
  field(DESC, "EVO firmware version")
  field(DTYP, "stream")
  field(INP, "@timing.proto frmvrs_get($(P),$(R)) $(PORT)")
}

record(longin, "$(P)$(R)FrmVersionC-Cte"){
  #field(ASG, "Reserved")
  field(DESC, "EVO firmware version")
  field(DTYP, "stream")
  field(INP, "@timing.proto frmvrs_get($(P),$(R)) $(PORT)")
}

record(calcout, "$(P)$(R)cmd_frmvrs_get"){
  field(ASG, "Reserved")
  field(DESC, "Firmware version read command code")
  field(VAL, "0xBE")
}

########################################################################
# Configuration Register [63]

record(longin, "$(P)$(R)Alive-Mon") {
  field(ASG, "Reserved")
  field(DESC, "alive")
  field(SCAN, "I/O Intr")
  field(DTYP, "stream")
  field(INP, "@timing.proto evg_conf_alive_intr $(PORT)")
  field(FLNK, "$(P)$(R)DevStatusCalc")
}

record(longin, "$(P)$(R)RFDivRaw") {
  field(ASG, "Reserved")
  field(DESC, "RF divider status RAW")
  field(SCAN, "I/O Intr")
  field(DTYP, "stream")
  field(INP, "@timing.proto evg_conf_rfdivRAW_intr $(PORT)")
  field(FLNK, "$(P)$(R)RFDiv-RB")
}

record(calc, "$(P)$(R)RFDiv-RB") {
  field(ASG, "Reserved")
  field(DESC, "RF divider status RBV")
  field(INPA, "$(P)$(R)RFDivRaw")
  field(CALC, "A+1")
}

record(mbbi, "$(P)$(R)DevFun-Sts") {
  field(ASG, "Reserved")
  field(DESC, "function select status")
  field(NOBT, "6")
  field(ZRVL, "16")
  field(ZRST, "FOUT")
  field(ONVL, "17")
  field(ONST, "EVR")
  field(TWVL, "18")
  field(TWST, "EVG")
  field(THVL, "32")
  field(THST, "EVE")
  field(SCAN, "I/O Intr")
  field(DTYP, "stream")
  field(INP, "@timing.proto evg_conf_funsel_intr $(PORT)")
}

record(mbbo, "$(P)$(R)DevFun-Sel") {
  field(DESC, "STD-EVO configuration as EVG")
  field(ZRVL, "16")
  field(ZRST, "FOUT")
  field(ONVL, "17")
  field(ONST, "EVR")
  field(TWVL, "18")
  field(TWST, "EVG")
  field(THVL, "32")
  field(THST, "EVE")
  field(VAL, "2")
  field(DTYP, "stream")
  field(OUT, "@timing.proto evg_conf_funsel_set($(P),$(R)) $(PORT)")
}

record(ao, "$(P)$(R)RFDiv-SP"){
  field(DESC, "RF clock divider")
  field(DTYP, "stream")
  field(DRVH, "4")
  field(DRVL, "4")
  field(VAL, "4")
  field(AOFF, "1")
  field(PREC, "0")
  field(OUT, "@timing.proto evg_conf_rfdiv_set($(P),$(R)) $(PORT)")
}

record(longout, "$(P)$(R)cmd_conf_get") {
  field(ASG, "Reserved")
  field(DESC, "Configuration reg read command code")
  field(VAL, "0xBF")
  field(SCAN, ".1 second")
  field(DTYP, "stream")
  field(OUT, "@timing.proto evg_conf_get($(P),$(R)) $(PORT)")
}

record(longout, "$(P)$(R)cmd_conf_set") {
  field(ASG, "Reserved")
  field(DESC, "Configuration reg write command code")
  field(VAL, "0x7F")
}

########################################################################
# Injection Table

# !ITBL.NELM MUST NOT BE MODIFIED!, since it affects the 
# event table length

record(waveform, "$(P)$(R)BucketList-SP") {
  field(DESC, "Injection table")
  field(PINI, "1")
  field(NELM, "864")
  field(FTVL, "USHORT")
  field(FLNK, "$(P)$(R)BucketListCalc")
}

record(acalcout, "$(P)$(R)BucketListCalc") {
  field(DESC, "Injection table calc validation")
  field(NELM, "864")
  field(INAA, "$(P)$(R)BucketList-SP")
  field(CALC, "AA[0,IXZ(AA>0 & AA<865)-1]; A:=IXZ(AA>0 & AA<865)")
  field(OUT, "$(P)$(R)BucketList-RB PP")
  field(FLNK, "$(P)$(R)BucketListLen-Mon PP")
}

record(longin, "$(P)$(R)BucketListLen-Mon") {
  field(INP, "$(P)$(R)BucketListCalc.A")
  field(DESC, "Length of the valid BucketList sequence")
}

record(waveform, "$(P)$(R)BucketList-RB") {
  field(DESC, "Injection table RBV")
  field(NELM, "864")
  field(FTVL, "USHORT")
}

record(longout, "$(P)$(R)RepeatBucketList-SP"){
  field(DESC, "BucketList repetition, 0=infinity")
  field(PINI, "1")
  field(DRVH, "100")
  field(DRVL, "0")
  field(FLNK, "$(P)$(R)RepeatBucketList-RB")
}

record(longin, "$(P)$(R)RepeatBucketList-RB"){
  field(DESC, "BucketList repetition, 0=infinity")
  field(INP, "$(P)$(R)RepeatBucketList-SP")
}

########################################################################
# Write all configuration registers
record(bo, "$(P)$(R)Download-Cmd") {
  field(DESC, "download")
  field(MASK, "1")
  field(ZNAM, "Dsbl")
  field(ONAM, "Enbl")
}

record(bo, "$(P)$(R)Download-Trig") {
  field(DESC, "download trigger")
  field(MASK, "1")
  field(ZNAM, "Dsbl")
  field(ONAM, "Enbl")
  field(DTYP, "stream")
  field(OUT, "@timing.proto evg_download($(P),$(R)) $(PORT)")
}

record(bo, "$(P)$(R)GetRBV") {
  field(DESC, "upload trigger")
  field(MASK, "1")
  field(ZNAM, "Dsbl")
  field(ONAM, "Enbl")
  #field(HIGH, "0.5")
  field(DTYP, "stream")
  field(OUT, "@timing.proto evg_get_rbv($(P),$(R)) $(PORT)")
}

record(calc, "$(P)$(R)DevStatusCalc") {
  field(ASG, "Reserved")
  field(DESC, "device status calc")
  field(INPA, "$(P)$(R)Alive-Mon")
  field(CALC, "A=0?0:1")
  field(ASG, "Reserved")
  field(FLNK, "$(P)$(R)DevStatus-Mon")
}

record(bi, "$(P)$(R)DevStatus-Mon") {
  field(ASG, "Reserved")
  field(DESC, "device status")
  field(ZNAM, "Waiting")
  field(ONAM, "Running")
  field(INP, "$(P)$(R)DevStatusCalc")
}

record(bi, "$(P)$(R)Network-Mon") {
  field(ASG, "Reserved")
  field(DESC, "network status")
  field(ZNAM, "Disconnected")
  field(ONAM, "Connected")
  field(FLNK, "$(P)$(R)FrmVersionA-Cte")
}

record(bo, "$(P)$(R)Save-Cmd"){
  field(DESC, "manual Save settings command")
  field(MASK, "1")
  field(ZNAM, "Dsbl")
  field(ONAM, "Enbl")
  field(FLNK, "$(P)$(R)Save-Trig")
}

record(calc, "$(P)$(R)Save-Trig"){
  field(DESC, "manual Save trigger")
  field(INPA, "$(P)$(R)Save-Cmd.VAL")
  field(CALC, "(A > 0) ? (VAL+1) : VAL")
  field(VAL, "0")
}

