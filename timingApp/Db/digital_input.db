########################################################################
# Digital input 0 -> 2 [53 + IN_N]
# PARAMETER IN_N: Input Number from 0 to 2

record(longout, "$(P)$(R)DIEvent$(IN_N)-SP") {
  field(DESC, "digital input 0 event code")
  field(DRVH, "255")
  field(DRVL, "0")
  field(DTYP, "stream")
  field(OUT, "@timing.proto evgre_diginp_ev_set($(P),$(R),$(IN_N)) $(PORT)")
}

record(bo, "$(P)$(R)DIEnbl$(IN_N)-Sel") {
  field(DESC, "digital input $(IN_N) enable")
  field(MASK, "1")
  field(ZNAM, "Dsbl")
  field(ONAM, "Enbl")
  field(FLNK, "$(P)$(R)DIStateCalc$(IN_N)")
  field(PINI, YES)
}

record(bo, "$(P)$(R)DIPol$(IN_N)-Sel") {
  field(DESC, "digital input $(IN_N) polarity")
  field(MASK, "1")
  field(ZNAM, "Normal")
  field(ONAM, "Inverse")
  field(FLNK, "$(P)$(R)DIPolCalc$(IN_N)")
}

record(bo, "$(P)$(R)DILog$(IN_N)-Sel") {
  field(DESC, "dig. input $(IN_N) event timestamp enable")
  field(MASK, "1")
  field(ZNAM, "Dsbl")
  field(ONAM, "Enbl")
  field(FLNK, "$(P)$(R)DILogCalc$(IN_N)")
}

record(calcout, "$(P)$(R)DIStateCalc$(IN_N)") {
  field(ASG, "Reserved")
  field(DESC, "digital input $(IN_N) set enable calc")
  field(DTYP, "stream")
  field(INPA, "$(P)$(R)DIEnbl$(IN_N)-Sel.RVAL")
  field(INPB, "$(P)$(R)DIPol$(IN_N)-Sts.VAL")
  field(INPC, "$(P)$(R)DILog$(IN_N)-Sts.VAL")
  field(CALC, "(A<<7)|(B<<6)|(C<<5)")
  field(OUT, "@timing.proto evgre_diginp_ept_set($(P),$(R),$(IN_N),DIStateCalc) $(PORT)")
  field(FLNK, "$(P)$(R)DI$(IN_N)Calc")
}

record(calcout, "$(P)$(R)DIPolCalc$(IN_N)") {
  field(ASG, "Reserved")
  field(DESC, "digital input $(IN_N) set polarity calc")
  field(DTYP, "stream")
  field(INPA, "$(P)$(R)DIEnbl$(IN_N)-Sts.VAL")
  field(INPB, "$(P)$(R)DIPol$(IN_N)-Sel.RVAL")
  field(INPC, "$(P)$(R)DILog$(IN_N)-Sts.VAL")
  field(CALC, "(A<<7)|(B<<6)|(C<<5)")
  field(OUT, "@timing.proto evgre_diginp_ept_set($(P),$(R),$(IN_N),DIPolCalc) $(PORT)")
  field(FLNK, "$(P)$(R)DI$(IN_N)Calc")
}

record(calcout, "$(P)$(R)DILogCalc$(IN_N)") {
  field(ASG, "Reserved")
  field(DESC, "digital input $(IN_N) set timestamp calc")
  field(DTYP, "stream")
  field(INPA, "$(P)$(R)DIEnbl$(IN_N)-Sts.VAL")
  field(INPB, "$(P)$(R)DIPol$(IN_N)-Sts.VAL")
  field(INPC, "$(P)$(R)DILog$(IN_N)-Sel.RVAL")
  field(CALC, "(A<<7)|(B<<6)|(C<<5)")
  field(OUT, "@timing.proto evgre_diginp_ept_set($(P),$(R),$(IN_N),DILogCalc) $(PORT)")
  field(FLNK, "$(P)$(R)DI$(IN_N)Calc")
}

record(calcout, "$(P)$(R)DI$(IN_N)Calc") {
  field(ASG, "Reserved")
  field(DESC, "dig.inp. $(IN_N) download en, pol and time")
  field(INPA, "$(P)$(R)DIEnbl$(IN_N)-Sel.RVAL")
  field(INPB, "$(P)$(R)DIPol$(IN_N)-Sel.RVAL")
  field(INPC, "$(P)$(R)DILog$(IN_N)-Sel.RVAL")
  field(CALC, "(A<<7)|(B<<6)|(C<<5)")
}

record(mbbiDirect, "$(P)$(R)DI$(IN_N)Raw") {
  field(ASG, "Reserved")
  field(DESC, "DIGINP$(IN_N) en, pol, and timestamp RBV")
  field(NOBT, "8")
  field(SHFT, "5")
  field(SCAN, "I/O Intr")
  field(DTYP, "stream")
  field(INP, "@timing.proto evgre_diginp$(IN_N)_intr $(PORT)")
  field(FLNK, "$(P)$(R)DILog$(IN_N)-Sts")
}

record(bi, "$(P)$(R)DILog$(IN_N)-Sts") {
  field(ASG, "Reserved")
  field(DESC, "digital input $(IN_N) timestamping sts")
  field(ZNAM, "Dsbl")
  field(ONAM, "Enbl")
  field(INP, "$(P)$(R)DI$(IN_N)Raw.B0")
  field(FLNK, "$(P)$(R)DIPol$(IN_N)-Sts")
}

record(bi, "$(P)$(R)DIPol$(IN_N)-Sts") {
  field(ASG, "Reserved")
  field(DESC, "digital input $(IN_N) polarity status")
  field(ZNAM, "Normal")
  field(ONAM, "Inverse")
  field(INP, "$(P)$(R)DI$(IN_N)Raw.B1")
  field(FLNK, "$(P)$(R)DIEnbl$(IN_N)-Sts")
}

record(bi, "$(P)$(R)DIEnbl$(IN_N)-Sts") {
  field(ASG, "Reserved")
  field(DESC, "digital input $(IN_N) enable status")
  field(ZNAM, "Dsbl")
  field(ONAM, "Enbl")
  field(INP, "$(P)$(R)DI$(IN_N)Raw.B2")
}

record(longin, "$(P)$(R)DIEvent$(IN_N)-RB") {
  field(ASG, "Reserved")
  field(DESC, "digital input $(IN_N) event RBV")
}

record(calc, "$(P)$(R)cmd_diginp_set$(IN_N)") {
  field(ASG, "Reserved")
  field(DESC, "Command code to write to DIGINP$(IN_N)")
  field(PINI, YES)
  field(INPA,"0x75")  # (0x40 | reg number=1)
  field(INPB,"$(IN_N)")
  field(CALC, "A+B")
}

record(calc, "$(P)$(R)cmd_diginp_get$(IN_N)") {
  field(ASG, "Reserved")
  field(DESC, "Command code to read DIGINP$(IN_N)")
  field(PINI, YES)
  field(INPA,"0xB5") # (0x80 | reg number=1)
  field(INPB,"$(IN_N)")
  field(CALC, "A+B")
}